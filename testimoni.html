<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="" />

    <title>Riz' Cakes | Testimoni Kategori</title>

    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/responsive.css" rel="stylesheet" />

    <style>
        /* Gaya Khusus Testimoni Kategori */
        .testimonial-box {
            background-color: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        .testimonial-box .client-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .testimonial-box .client-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .testimonial-box .client-info h5 {
            color: #ff4a68;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .testimonial-box .product-tag {
            display: inline-block;
            background-color: #ff4a68;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 1em;
            margin-bottom: 10px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .testimonial-box .comment {
            font-style: italic;
            color: #495057;
            margin-bottom: 10px;
            flex-grow: 1;
        }

        /* Gaya tombol arsip di dalam kotak */
        .archive-button-in-box {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 0.9em;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.3s;
            text-align: center;
            width: 100%;
        }

        .archive-button-in-box:hover {
            background-color: #5a6268;
        }
        
        .empty-comment {
            color: #ccc;
            font-style: normal;
        }
    </style>
</head>

<body class="sub_page">

    <div class="hero_area">
        <header class="header_section">
            <div class="container-fluid">
                <nav class="navbar navbar-expand-lg custom_nav-container ">
                    <a class="navbar-brand" href="index.html">
                        <span>Riz' Cakes</span>
                    </a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class=""> </span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a class="nav-link" href="index.html">Beranda</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="tentang kami.html">Tentang Kami</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="produk.html">Produk</a>
                            </li>
                            <li class="nav-item active">
                                <a class="nav-link" href="testimoni.html">Testimoni <span
                                        class="sr-only">(current)</span></a>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </header>
        </div>

    <section class="testimonial_section layout_padding">
        <div class="container">
            <div class="heading_container">
                <h2>Testimoni Pelanggan Berdasarkan Kategori</h2>
                <p>Ulasan terbaru untuk setiap jenis kue kami.</p>
            </div>

            <div id="category-testimonial-container" class="row">
                </div>

            <hr class="mt-5 mb-5">

            <div class="row mt-5" id="testimonial-form-section">
                <div class="col-md-8 mx-auto">
                    <div class="heading_container">
                        <h3>Tambahkan Testimoni Anda</h3>
                    </div>
                    <form id="testimonial-form">
                        <div class="form-group">
                            <input type="text" id="input-name" class="form-control" placeholder="Nama Lengkap"
                                required />
                        </div>
                        <div class="form-group">
                            <select id="input-product" class="form-control" required>
                                <option value="" disabled selected>Pilih Kategori Produk yang Anda Komentari</option>
                                <option value="KUE BROWNIES">KUE BROWNIES</option>
                                <option value="KUE KARAKTER">KUE KARAKTER</option>
                                <option value="FRUIT CAKES">FRUIT CAKES</option>
                                <option value="KUE VIRAL">KUE VIRAL</option>
                                <option value="KUE ULANG TAHUN">KUE ULANG TAHUN</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <textarea id="input-comment" class="form-control" placeholder="Tulis Komentar Anda..."
                                rows="4" required></textarea>
                        </div>
                        <div class="d-flex justify-content-center mt-4">
                            <button type="submit" class="whatsapp_btn">
                                KIRIM TESTIMONI
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <div class="footer_container">
        <section class="info_section ">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center" style="margin-bottom: 20px; margin-top: 20px;">
                        <h3 style="color: white; margin-bottom: 20px;">Siap Memesan Kue Impian Anda?</h3>
                        <a href="https://wa.me/628976601080" target="_blank" class="whatsapp_btn">
                            <i class="fa fa-whatsapp" aria-hidden="true"></i> Pesan Sekarang via WhatsApp
                        </a>
                    </div>
                </div>
            </div>
        </section>
        <footer class="footer_section">
            <div class="container">
                <p>
                    &copy; <span id="displayYear"></span> All Rights Reserved By
                    <a href="https://html.design/"></a>
                </p>
            </div>
        </footer>
    </div>
    
    <div class="modal fade" id="reviewSuccessModal" tabindex="-1" aria-labelledby="reviewSuccessModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #ff4a68; color: white; border-bottom: none;">
                    <h5 class="modal-title" id="reviewSuccessModalLabel">Terima Kasih!</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                        style="color: white; opacity: 1;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-center">
                    <i class="fa fa-check-circle" style="font-size: 48px; color: #28a745; margin-bottom: 15px;"></i>
                    <p>Testimoni Anda telah berhasil ditambahkan.</p>
                    <p>Silakan lihat ulasan Anda di kotak kategori.</p>
                </div>
                <div class="modal-footer justify-content-center" style="border-top: none;">
                    <button type="button" class="whatsapp_btn" data-dismiss="modal" style="background-color: #ff4a68;">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal fade" id="archiveModal" tabindex="-1" aria-labelledby="archiveModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #ff4a68; color: white; border-bottom: none;">
                    <h5 class="modal-title" id="archiveModalLabel"><i class="fa fa-archive"></i> Arsip Komentar <span id="archiveCategoryTitle"></span></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: white; opacity: 1;">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p class="text-muted">Menampilkan komentar yang tergeser oleh ulasan terbaru (Maksimal 5 komentar di arsip ini).</p>
                    <div id="archive-list">
                        </div>
                </div>
                <div class="modal-footer justify-content-center" style="border-top: none;">
                    <button type="button" class="whatsapp_btn" data-dismiss="modal" style="background-color: #ff4a68;">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.js"></script>
    
    <script>
        const CATEGORIES = ["KUE ULANG TAHUN", "KUE BROWNIES", "FRUIT CAKES", "KUE KARAKTER", "KUE VIRAL"];
        const IMAGE_MAP = {
            "KUE ULANG TAHUN": "images/images (1).jpeg",
            "KUE BROWNIES": "images/all in.png",
            "FRUIT CAKES": "images/straw.png",
            "KUE KARAKTER": "images/kuromi.png",
            "KUE VIRAL": "images/images.jpeg"
        };
        const FORM_SECTION_ID = '#testimonial-form-section';
        const ARCHIVE_MAX_COUNT = 5;

        // Struktur data baru: Menyimpan komentar aktif dan arsip per kategori
        let categoryData = {
            "KUE ULANG TAHUN": {
                active: { name: "Sarah W.", product: "KUE ULANG TAHUN", comment: "Kue ulang tahunnya sangat cantik dan rasanya luar biasa!" },
                archive: [
                    { name: "Andi S.", product: "KUE ULANG TAHUN", comment: "Kue tema mobilnya keren!" },
                ]
            },
            "KUE BROWNIES": {
                active: { name: "Budi H.", product: "KUE BROWNIES", comment: "Browniesnya 'lumer' banget di mulut, cokelatnya premium dan tebal." },
                archive: [
                    { name: "Rizky D.", product: "KUE BROWNIES", comment: "Tekstur browniesnya padat tapi moist. Cokelatnya benar-benar terasa, top!" },
                ]
            },
            "FRUIT CAKES": {
                active: { name: "Dewi P.", product: "FRUIT CAKES", comment: "Fruit cakes-nya segar sekali, buahnya banyak dan beragam." },
                archive: [
                    { name: "Cynthia A.", product: "FRUIT CAKES", comment: "Suka banget sama kesegaran buahnya. Selalu jadi pilihan saat kumpul keluarga." },
                ]
            },
            "KUE KARAKTER": {
                active: { name: "Ahmad Z.", product: "KUE KARAKTER", comment: "Pesan kue karakter superhero untuk anak. Hasilnya detail, warnanya cerah!" },
                archive: [
                    { name: "Mia B.", product: "KUE KARAKTER", comment: "Kue karakter unicorn-nya menggemaskan! Servis cepat dan ramah." },
                ]
            },
            "KUE VIRAL": {
                active: { name: "Fitri M.", product: "KUE VIRAL", comment: "Rasa kue viralnya memang gak bohong, enak banget dan teksturnya lembut." },
                archive: [
                    { name: "Joko P.", product: "KUE VIRAL", comment: "Baru coba kue viralnya, rasanya sesuai ekspektasi. Lezat sekali!" },
                ]
            }
        };


        // Fungsi untuk membuat elemen HTML kotak kategori
        function createCategoryElement(categoryName, data) {
            const col = document.createElement('div');
            col.className = 'col-md-6 col-lg-4 d-flex'; // Menggunakan col-lg-4 untuk 3 kolom

            const commentText = data.active.comment ? `"${data.active.comment}"` : `<span class="empty-comment">Belum ada ulasan untuk kategori ini.</span>`;
            const clientName = data.active.name || 'Pelanggan';

            // Tombol Arsip hanya muncul jika ada komentar di arsip
            const archiveButtonHtml = (data.archive.length > 0)
                ? `<button class="archive-button-in-box show-archive-btn" data-category="${categoryName}">
                       <i class="fa fa-book" aria-hidden="true"></i> ${data.archive.length} Komentar Lama
                   </button>`
                : `<button class="archive-button-in-box" disabled style="opacity: 0.5;">
                       <i class="fa fa-book" aria-hidden="true"></i> Arsip Kosong
                   </button>`;

            col.innerHTML = `
                <div class="testimonial-box">
                    <img src="${IMAGE_MAP[categoryName] || 'images/default-cake.jpg'}" class="client-image" alt="Gambar ${categoryName}">
                    <div class="client-info">
                        <span class="product-tag">${categoryName}</span>
                        <h5>${clientName}</h5>
                        <p class="comment">${commentText}</p>
                        ${archiveButtonHtml}
                    </div>
                </div>
            `;

            const testimonialBox = col.querySelector('.testimonial-box');
            
            // 1. Fungsionalitas Scroll ke Form saat kotak diklik (kecuali tombol arsip)
            testimonialBox.addEventListener('click', function(e) {
                if (e.target.closest('.show-archive-btn')) {
                    return; 
                }
                $('html, body').animate({
                    scrollTop: $(FORM_SECTION_ID).offset().top - 80 
                }, 1000); 
            });

            // 2. Event listener untuk Tombol Arsip
            const archiveBtn = col.querySelector('.show-archive-btn');
            if (archiveBtn) {
                 archiveBtn.addEventListener('click', function(e) {
                     e.stopPropagation(); 
                     showCategoryArchiveModal(categoryName);
                 });
            }

            return col;
        }

        // Fungsi untuk menampilkan semua kategori
        function renderCategoryTestimonials() {
            const container = document.getElementById('category-testimonial-container');
            container.innerHTML = ''; 
            
            CATEGORIES.forEach(category => {
                const data = categoryData[category];
                container.appendChild(createCategoryElement(category, data)); 
            });
        }

        // Fungsi untuk mengisi dan menampilkan modal arsip kategori spesifik
        function showCategoryArchiveModal(categoryName) {
            const archiveList = document.getElementById('archive-list');
            const archiveTitle = document.getElementById('archiveCategoryTitle');
            const archive = categoryData[categoryName].archive;
            
            archiveTitle.textContent = categoryName;
            archiveList.innerHTML = ''; 

            if (archive.length === 0) {
                archiveList.innerHTML = '<p class="text-center text-muted mt-3">Arsip untuk kategori ini kosong.</p>';
            } else {
                // Tampilkan komentar, terbaru (di awal array) di atas
                archive.forEach(review => {
                    const item = document.createElement('div');
                    item.className = 'card mb-3';
                    item.innerHTML = `
                        <div class="card-body">
                            <h6 class="card-title text-primary">${review.name}</h6>
                            <p class="card-text">${review.comment}</p>
                        </div>
                    `;
                    archiveList.appendChild(item);
                });
            }

            $('#archiveModal').modal('show');
        }


        // Inisialisasi dan Logika Submit Form
        document.addEventListener('DOMContentLoaded', () => {
            renderCategoryTestimonials();
            
            const form = document.getElementById('testimonial-form');
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                
                const category = document.getElementById('input-product').value;
                const newTestimonial = {
                    name: document.getElementById('input-name').value,
                    product: category,
                    comment: document.getElementById('input-comment').value,
                };
                
                if (!categoryData[category]) {
                    console.error("Kategori produk tidak valid.");
                    return;
                }
                
                const categoryArchive = categoryData[category].archive;
                const currentActive = categoryData[category].active;

                // ROTASI KOMENTAR KHUSUS KATEGORI INI
                
                // 1. Pindahkan komentar aktif LAMA ke arsip
                if (currentActive.comment) { 
                    // Tambahkan di awal array (unshift) agar yang terbaru di arsip selalu di atas
                    categoryArchive.unshift(currentActive);
                }
                
                // 2. Komentar BARU menjadi komentar aktif
                categoryData[category].active = newTestimonial;

                // 3. Batasi arsip: Hapus yang TERLAMA (pop) jika melebihi batas (5)
                if (categoryArchive.length > ARCHIVE_MAX_COUNT) {
                    categoryArchive.pop(); // Menghapus elemen terakhir/terlama
                }

                // Render ulang Testimoni
                renderCategoryTestimonials();
                
                // Reset form dan tampilkan modal sukses
                form.reset();
                $('#reviewSuccessModal').modal('show');
                
                // Scroll ke kotak kategori yang baru di update
                $('html, body').animate({
                    scrollTop: $(`#category-testimonial-container`).offset().top - 80 
                }, 1000); 
            });
            
            // Set tahun di footer
            document.getElementById("displayYear").innerText = new Date().getFullYear();
        });
    </script>
    <script src="js/custom.js"></script>

</body>

</html>